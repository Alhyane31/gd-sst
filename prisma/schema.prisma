generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  USER
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  role      Role     @default(USER)
  isActive  Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Formation {
  id        String    @id @default(uuid())
  code      String    @unique
  libelle   String

  services  Service[]
  personnels Personnel[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Service {
  id           String    @id @default(uuid())
  code         String    @unique
  libelle      String

  formationId  String
  formation    Formation @relation(fields: [formationId], references: [id])

  personnels   Personnel[]
   bordereaux Bordereau[]
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  
}
model Poste {
  id        String      @id @default(uuid())
  code      String      @unique
  libelle   String

  personnels Personnel[]

  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
}
enum PersonnelCategorie {
  SMR
  VP
}

model Personnel {
  id           String   @id @default(uuid())
  firstName    String
  lastName     String
  email        String?  @unique
  isActive     Boolean  @default(true)

  posteId      String
  poste        Poste    @relation(fields: [posteId], references: [id])

  serviceId    String
  service      Service  @relation(fields: [serviceId], references: [id])

  formationId  String
  formation    Formation @relation(fields: [formationId], references: [id])

  // ✅ nouveaux champs
  categorie    PersonnelCategorie @default(VP)
  tags         String[]           @default([])

  convocations      Convocation[]

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}




model Convocation {
  id              String          @id @default(uuid())

  
  datePrevue       DateTime  
  dateRealisee     DateTime?

  

  statut          ConvocationStatut    @default(A_CONVOQUER)

  convocationType ConvocationType @default(INITIALE)

  dateConvocation DateTime?


    // ✅ lien vers bordereau (1 convocation ∈ 0..1 bordereau)
  bordereauId   String?
  bordereau     Bordereau? @relation(fields: [bordereauId], references: [id])

  // ✅ texte libre
  commentaire     String?

  personnelId     String
  personnel       Personnel       @relation(fields: [personnelId], references: [id])

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([personnelId, datePrevue])
  @@index([statut])
  
}
model JourFerie {
  id        String   @id @default(uuid())
  date      DateTime @unique
  label     String?  // ex: "Fête du Travail", "Aid Al Adha"
  
  createdAt DateTime @default(now())

  @@index([date])
}

enum VisiteType {
  ANNUELLE
  RAPPROCHEE
}

enum ConvocationStatut {
  A_CONVOQUER            // pas encore traité
  CONVOCATION_GENEREE    // convocation générée (pdf/email prêt)
  A_TRAITER              // retour/présence à vérifier, ou action attendue
  A_RELANCER             // échec/no-show => doit être relancé
  RELANCEE               // relance envoyée
  REALISEE   
  ANNULEE            // convocation effectuée
}

enum ConvocationType {
  INITIALE
  RELANCE_1
  RELANCE_2
  RELANCE_3
}

enum BordereauStatut {
  NOUVEAU
  GENERE
}

model Bordereau {
  id           String          @id @default(uuid())
  serviceId    String
  service      Service         @relation(fields: [serviceId], references: [id])

  dateEdition  DateTime        @default(now()) // date d’édition du bordereau
  serialNumber String          @unique          // numéro auto

  statut       BordereauStatut @default(NOUVEAU)

  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  convocations Convocation[]   // via convocation.bordereauId
}
